<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HabitQuest Notification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f2f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #45a049; }
        button:disabled { background: #cccccc; cursor: not-allowed; }
        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ HabitQuest Notification Test</h1>
        <p>Use this tool to test if notifications work on your system before running the main app.</p>
        
        <div id="permissionStatus" class="status info">
            üîç Checking notification permissions...
        </div>
        
        <div>
            <button id="requestPermission">Request Permissions</button>
            <button id="testNotification" disabled>Test Notification</button>
            <button id="testMultiple" disabled>Test Multiple (5 notifications)</button>
            <button id="testPersistent" disabled>Test Background Timer</button>
        </div>
        
        <div id="testResults"></div>
        
        <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
            <h3>üìã Testing Instructions:</h3>
            <ol>
                <li><strong>Permission Check:</strong> Shows current notification permission status</li>
                <li><strong>Request Permissions:</strong> Ask browser/system for notification permissions</li>
                <li><strong>Test Notification:</strong> Send a single test notification</li>
                <li><strong>Test Multiple:</strong> Send 5 notifications to test reliability</li>
                <li><strong>Test Background:</strong> Send notifications every 30 seconds</li>
            </ol>
            <p><strong>Expected Results:</strong> You should see desktop notifications appear in the bottom-right corner of your screen (Windows) with the HabitQuest icon and message.</p>
        </div>
    </div>

    <script>
        let backgroundInterval;
        
        // Check initial permission status
        function updatePermissionStatus() {
            const status = document.getElementById('permissionStatus');
            const buttons = document.querySelectorAll('button:not(#requestPermission)');
            
            if (!("Notification" in window)) {
                status.innerHTML = '‚ùå This browser does not support notifications';
                status.className = 'status error';
                return;
            }
            
            switch (Notification.permission) {
                case 'granted':
                    status.innerHTML = '‚úÖ Notification permissions granted - Ready to test!';
                    status.className = 'status success';
                    buttons.forEach(btn => btn.disabled = false);
                    break;
                case 'denied':
                    status.innerHTML = '‚ùå Notification permissions denied - Please enable in browser settings';
                    status.className = 'status error';
                    buttons.forEach(btn => btn.disabled = true);
                    break;
                case 'default':
                    status.innerHTML = '‚ö†Ô∏è Notification permissions not set - Click "Request Permissions"';
                    status.className = 'status warning';
                    buttons.forEach(btn => btn.disabled = true);
                    break;
            }
        }
        
        // Request notification permission
        document.getElementById('requestPermission').addEventListener('click', async () => {
            if (!("Notification" in window)) {
                alert('This browser does not support notifications');
                return;
            }
            
            try {
                const permission = await Notification.requestPermission();
                updatePermissionStatus();
                
                if (permission === 'granted') {
                    addResult('‚úÖ Permission granted successfully!', 'success');
                } else {
                    addResult('‚ùå Permission denied or dismissed', 'error');
                }
            } catch (error) {
                addResult('‚ùå Error requesting permissions: ' + error.message, 'error');
            }
        });
        
        // Test single notification
        document.getElementById('testNotification').addEventListener('click', () => {
            try {
                const notification = new Notification('üéØ HabitQuest Test', {
                    body: 'If you see this, notifications are working correctly!',
                    icon: '/favicon.png',
                    tag: 'habitquest-test',
                    requireInteraction: false,
                    silent: false
                });
                
                notification.onclick = () => {
                    addResult('üëÜ Notification clicked!', 'info');
                    notification.close();
                };
                
                notification.onshow = () => {
                    addResult('‚úÖ Test notification sent successfully', 'success');
                };
                
                notification.onerror = (error) => {
                    addResult('‚ùå Notification error: ' + error, 'error');
                };
                
                // Auto-close after 5 seconds
                setTimeout(() => {
                    if (notification) notification.close();
                }, 5000);
                
            } catch (error) {
                addResult('‚ùå Error sending notification: ' + error.message, 'error');
            }
        });
        
        // Test multiple notifications
        document.getElementById('testMultiple').addEventListener('click', () => {
            addResult('üì§ Sending 5 test notifications...', 'info');
            
            for (let i = 1; i <= 5; i++) {
                setTimeout(() => {
                    try {
                        const notification = new Notification(`üéØ Test Notification ${i}/5`, {
                            body: `This is test notification number ${i}. Testing reliability...`,
                            icon: '/favicon.png',
                            tag: `habitquest-test-${i}`,
                            requireInteraction: false
                        });
                        
                        setTimeout(() => notification.close(), 3000);
                        
                        if (i === 5) {
                            setTimeout(() => {
                                addResult('‚úÖ All 5 notifications sent successfully!', 'success');
                            }, 1000);
                        }
                    } catch (error) {
                        addResult(`‚ùå Error sending notification ${i}: ${error.message}`, 'error');
                    }
                }, i * 1000); // 1 second apart
            }
        });
        
        // Test background notifications
        document.getElementById('testPersistent').addEventListener('click', (e) => {
            if (backgroundInterval) {
                // Stop background notifications
                clearInterval(backgroundInterval);
                backgroundInterval = null;
                e.target.textContent = 'Test Background Timer';
                e.target.style.background = '#4CAF50';
                addResult('‚èπÔ∏è Background notification timer stopped', 'warning');
            } else {
                // Start background notifications
                let count = 0;
                backgroundInterval = setInterval(() => {
                    count++;
                    try {
                        const notification = new Notification(`üîÑ Background Test ${count}`, {
                            body: `Background notification ${count} - This simulates the HabitQuest reminder system`,
                            icon: '/favicon.png',
                            tag: `background-test-${count}`,
                            requireInteraction: false
                        });
                        
                        setTimeout(() => notification.close(), 4000);
                        
                        addResult(`üì® Background notification ${count} sent`, 'info');
                        
                        // Stop after 10 notifications
                        if (count >= 10) {
                            clearInterval(backgroundInterval);
                            backgroundInterval = null;
                            e.target.textContent = 'Test Background Timer';
                            e.target.style.background = '#4CAF50';
                            addResult('üèÅ Background test completed (10 notifications sent)', 'success');
                        }
                    } catch (error) {
                        addResult(`‚ùå Background notification ${count} failed: ${error.message}`, 'error');
                    }
                }, 3000); // Every 3 seconds
                
                e.target.textContent = 'Stop Background Test';
                e.target.style.background = '#f44336';
                addResult('‚ñ∂Ô∏è Background notification timer started (every 3 seconds)', 'success');
            }
        });
        
        // Add test result to the page
        function addResult(message, type) {
            const results = document.getElementById('testResults');
            const result = document.createElement('div');
            result.className = `status ${type}`;
            result.innerHTML = `<small>${new Date().toLocaleTimeString()}</small><br>${message}`;
            results.appendChild(result);
            results.scrollTop = results.scrollHeight;
        }
        
        // Initialize on page load
        updatePermissionStatus();
        
        // Update status when page regains focus (in case permissions changed)
        window.addEventListener('focus', updatePermissionStatus);
    </script>
</body>
</html>